<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lokup ãƒ¬ãƒãƒ¼ãƒˆ - {{.Repository}}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 40px 20px; text-align: center;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .meta {
            display: flex; justify-content: center; gap: 30px;
            margin-top: 20px; font-size: 0.95rem;
        }
        .section {
            background: white; border-radius: 12px; padding: 30px;
            margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .section h2 {
            font-size: 1.5rem; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 2px solid #eee;
        }

        /* Overall Grade */
        .overall-grade.grade-a { color: #22c55e; }
        .overall-grade.grade-b { color: #84cc16; }
        .overall-grade.grade-c { color: #eab308; }
        .overall-grade.grade-d { color: #ef4444; }

        /* Section-level Details (Level 3 progressive disclosure) */
        .section-details {
            background: white; border-radius: 12px;
            margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .section-summary {
            display: flex; align-items: center; gap: 12px;
            padding: 20px 30px; cursor: pointer;
            font-size: 1.1rem; list-style: none;
            user-select: none;
        }
        .section-summary::-webkit-details-marker { display: none; }
        .section-summary::before {
            content: 'â–¶'; font-size: 0.8rem; color: #999;
            transition: transform 0.2s;
        }
        .section-details[open] > .section-summary::before {
            transform: rotate(90deg);
        }
        .section-summary .summary-name {
            font-weight: 600; flex: 1; font-size: 1.2rem;
        }
        .section-summary .cat-score-badge {
            font-size: 1rem; font-weight: bold;
            padding: 4px 14px; border-radius: 20px;
        }

        /* Category Score Cards */
        .category-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }
        .category-card {
            background: #f8f9fa; border-radius: 10px; padding: 20px;
            text-align: center; border-top: 4px solid #ddd;
        }
        .category-card.grade-a { border-top-color: #22c55e; }
        .category-card.grade-b { border-top-color: #84cc16; }
        .category-card.grade-c { border-top-color: #eab308; }
        .category-card.grade-d { border-top-color: #ef4444; }
        .category-card .cat-icon { font-size: 1.5rem; }
        .category-card .cat-name { font-size: 0.9rem; color: #666; margin-top: 4px; }
        .category-card .cat-score {
            font-size: 2.5rem; font-weight: bold; margin: 8px 0;
        }
        .cat-score.grade-a { color: #22c55e; }
        .cat-score.grade-b { color: #84cc16; }
        .cat-score.grade-c { color: #eab308; }
        .cat-score.grade-d { color: #ef4444; }
        .category-card .cat-grade { font-size: 1rem; color: #666; }
        .category-card .cat-diagnosis {
            font-size: 0.85rem; color: #888; margin-top: 10px;
            line-height: 1.5;
        }

        /* Category Detail Section */
        .category-section {
            background: white; border-radius: 12px; padding: 30px;
            margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .category-header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 8px;
        }
        .category-header .cat-icon { font-size: 1.5rem; }
        .category-header h2 {
            font-size: 1.5rem; margin: 0; padding: 0; border: none;
        }
        .category-header .cat-score-badge {
            margin-left: auto; font-size: 1.2rem; font-weight: bold;
            padding: 4px 12px; border-radius: 20px; background: #f0f0f0;
        }
        .cat-score-badge.grade-a { background: #dcfce7; color: #166534; }
        .cat-score-badge.grade-b { background: #ecfccb; color: #3f6212; }
        .cat-score-badge.grade-c { background: #fef9c3; color: #854d0e; }
        .cat-score-badge.grade-d { background: #fecaca; color: #991b1b; }
        .category-diagnosis {
            color: #666; margin-bottom: 20px; font-size: 0.95rem;
            padding-bottom: 15px; border-bottom: 1px solid #eee;
        }

        /* Metric Details Card */
        details.metric-detail {
            margin: 10px 0; border: 1px solid #e5e7eb; border-radius: 8px;
            overflow: hidden;
        }
        details.metric-detail summary {
            display: flex; align-items: center; padding: 14px 18px;
            cursor: pointer; background: #f8f9fa;
            font-size: 0.95rem; list-style: none;
            user-select: none;
        }
        details.metric-detail summary::-webkit-details-marker { display: none; }
        details.metric-detail summary::before {
            content: 'â–¶'; margin-right: 10px; font-size: 0.7rem;
            transition: transform 0.2s; color: #999;
        }
        details.metric-detail[open] summary::before {
            transform: rotate(90deg);
        }
        details.metric-detail summary .metric-name {
            font-weight: 600; flex: 1;
        }
        details.metric-detail summary .metric-value {
            font-weight: bold; font-size: 1.1rem; margin-right: 12px;
            color: #667eea;
        }
        details.metric-detail summary .metric-value.warning {
            color: #ca8a04;
        }
        details.metric-detail summary .metric-status {
            font-size: 1.1rem;
        }
        /* DORA Rating Badges */
        .dora-badge {
            font-size: 0.75rem !important; font-weight: bold;
            padding: 2px 8px; border-radius: 10px;
        }
        .dora-elite { background: #dcfce7; color: #166534; }
        .dora-high { background: #dbeafe; color: #1e40af; }
        .dora-medium { background: #fef9c3; color: #854d0e; }
        .dora-low { background: #fecaca; color: #991b1b; }
        .dora-n\/a { background: #f3f4f6; color: #6b7280; }
        /* Trend Arrows */
        .trend-section { margin: 20px 0; }
        .trend-item {
            display: flex; align-items: center; gap: 12px;
            padding: 8px 0; border-bottom: 1px solid #f0f0f0;
        }
        .trend-item:last-child { border-bottom: none; }
        .trend-arrow { font-size: 1.2rem; width: 24px; text-align: center; }
        .trend-arrow.up { color: #22c55e; }
        .trend-arrow.down { color: #ef4444; }
        .trend-arrow.same { color: #9ca3af; }
        .trend-name { flex: 1; font-size: 0.9rem; color: #555; }
        .trend-delta { font-size: 0.9rem; font-weight: bold; }
        .trend-delta.up { color: #22c55e; }
        .trend-delta.down { color: #ef4444; }
        .trend-delta.same { color: #9ca3af; }
        details.metric-detail .detail-content {
            padding: 20px; border-top: 1px solid #e5e7eb;
        }
        .detail-section { margin-bottom: 16px; }
        .detail-section:last-child { margin-bottom: 0; }
        .detail-section h4 {
            font-size: 0.9rem; color: #667eea; margin-bottom: 8px;
        }
        .detail-section p {
            font-size: 0.9rem; color: #555; line-height: 1.6;
        }
        .detail-section ul {
            margin: 0; padding-left: 20px;
        }
        .detail-section li {
            font-size: 0.9rem; color: #555; line-height: 1.8;
        }
        .detail-chart {
            position: relative; height: 250px; margin: 10px 0;
        }
        .detail-table {
            width: 100%; border-collapse: collapse;
            font-size: 0.85rem; margin-top: 8px;
        }
        .detail-table th {
            text-align: left; padding: 8px; background: #f8f9fa;
            border-bottom: 2px solid #eee; font-weight: 600; color: #666;
        }
        .detail-table td {
            padding: 8px; border-bottom: 1px solid #eee;
        }
        .detail-table .risk-icon { width: 40px; text-align: center; }
        .detail-table .file-path { word-break: break-all; color: #333; }
        .detail-table .file-size { text-align: right; color: #666; }

        /* Score Breakdown */
        .score-breakdown { margin-top: 15px; }
        .score-breakdown table { width: 100%; font-size: 0.85rem; }
        .score-breakdown td { padding: 4px 0; }
        .score-breakdown .points { text-align: right; font-weight: bold; }
        .score-breakdown .positive .points { color: #22c55e; }
        .score-breakdown .negative .points { color: #ef4444; }
        .score-breakdown .total {
            border-top: 1px solid #ddd; font-weight: bold;
        }
        .score-breakdown .total td { padding-top: 8px; }
        .score-breakdown .detail { color: #999; font-size: 0.8rem; }

        /* AI Comment Section */
        .ai-hero-insight {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8ecff 100%);
            border: 1px solid #c7d2fe;
            border-radius: 10px; padding: 24px;
            margin-bottom: 20px; text-align: center;
        }
        .ai-hero-insight .ai-hero-label {
            font-size: 0.8rem; color: #667eea; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;
        }
        .ai-hero-insight .ai-hero-text {
            font-size: 1.15rem; font-weight: 600; color: #333; line-height: 1.6;
        }
        .ai-hero-insight .ai-hero-action {
            display: inline-block; margin-top: 12px;
            font-size: 0.9rem; color: #667eea; font-weight: 500;
        }
        .ai-insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px; margin-bottom: 20px;
        }
        .ai-insight-card {
            border-radius: 8px; padding: 16px;
            border-left: 4px solid #ddd;
        }
        .ai-insight-card.good { background: #f0fdf4; border-left-color: #22c55e; }
        .ai-insight-card.warn { background: #fffbeb; border-left-color: #eab308; }
        .ai-insight-card.bad { background: #fef2f2; border-left-color: #ef4444; }
        .ai-insight-card .ai-card-icon { font-size: 1.2rem; margin-bottom: 4px; }
        .ai-insight-card .ai-card-title {
            font-size: 0.85rem; color: #888; margin-bottom: 4px;
        }
        .ai-insight-card .ai-card-value {
            font-size: 1.3rem; font-weight: bold; color: #333;
        }
        .ai-insight-card .ai-card-note {
            font-size: 0.82rem; color: #666; margin-top: 6px; line-height: 1.5;
        }
        .ai-actions { margin-bottom: 16px; }
        .ai-actions h3 {
            font-size: 0.95rem; color: #444; margin-bottom: 10px;
        }
        .ai-action-item {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 10px 14px; margin-bottom: 8px;
            background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;
        }
        .ai-action-item .ai-action-num {
            font-size: 0.85rem; font-weight: bold; color: #fff;
            background: #667eea; width: 22px; height: 22px;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; flex-shrink: 0; margin-top: 2px;
        }
        .ai-action-item .ai-action-text {
            font-size: 0.9rem; color: #444; line-height: 1.6;
        }
        .ai-action-item .ai-action-text strong { color: #333; }
        .ai-note-toggle summary {
            font-size: 0.85rem; color: #999; cursor: pointer;
            list-style: none; user-select: none;
        }
        .ai-note-toggle summary::-webkit-details-marker { display: none; }
        .ai-note-toggle summary::before {
            content: 'â–¶ '; font-size: 0.7rem;
        }
        .ai-note-toggle[open] summary::before { content: 'â–¼ '; }
        .ai-note-toggle .ai-note-content {
            margin-top: 10px; font-size: 0.85rem; color: #777;
            line-height: 1.7; padding: 12px; background: #f9fafb;
            border-radius: 6px;
        }

        /* Risk Section */
        .risks-list { display: flex; flex-direction: column; gap: 15px; }
        .risk-item {
            display: flex; align-items: flex-start; gap: 15px;
            padding: 15px; border-radius: 8px; background: #f8f9fa;
        }
        .risk-item.high { border-left: 4px solid #ef4444; }
        .risk-item.medium { border-left: 4px solid #eab308; }
        .risk-item.low { border-left: 4px solid #22c55e; }
        .risk-icon { font-size: 1.5rem; }
        .risk-content h4 { font-size: 1rem; margin-bottom: 5px; }
        .risk-content p { font-size: 0.9rem; color: #666; }
        .risk-content .risk-action {
            margin-top: 10px; padding: 10px; background: #f0f9ff;
            border-radius: 6px; color: #0369a1; font-size: 0.85rem;
        }
        .no-risks {
            text-align: center; padding: 40px; color: #22c55e; font-size: 1.1rem;
        }

        /* Chart */
        .chart-container {
            position: relative; height: 300px; margin-top: 20px;
        }
        footer {
            text-align: center; padding: 30px; color: #999; font-size: 0.85rem;
        }
        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .meta { flex-direction: column; gap: 10px; }
            .category-scores { grid-template-columns: 1fr 1fr; }
            .cat-score { font-size: 2rem !important; }
        }
    </style>
</head>
<body>
    <header>
        <h1>{{.Repository}}</h1>
        <p class="subtitle">GitHub ãƒªãƒã‚¸ãƒˆãƒªå¥åº·è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ</p>
        <div class="meta">
            <span>åˆ†ææœŸé–“: {{.PeriodFrom}} ~ {{.PeriodTo}} ({{.PeriodDays}}æ—¥é–“)</span>
            <span>ç”Ÿæˆæ—¥æ™‚: {{.GeneratedAt}}</span>
        </div>
    </header>

    <div class="container">
        <!-- Level 1: Hero - Overall Grade -->
        <section class="section" style="text-align:center; padding: 40px 30px;">
            <div class="overall-grade {{.OverallGradeClass}}" style="font-size: 5rem; font-weight: bold; line-height: 1;">{{.OverallGrade}}</div>
            <div style="font-size: 1.3rem; color: #666; margin-top: 8px;">ç·åˆã‚¹ã‚³ã‚¢: {{.OverallScore}} / 100</div>
            <div style="font-size: 1.05rem; color: #888; margin-top: 12px;">{{.OverallDiagnosis}}</div>
        </section>

        <!-- Level 2: Category Score Cards (simple) -->
        <section class="section">
            <div class="category-scores">
                {{range .Categories}}
                <div class="category-card {{.GradeClass}}">
                    <div class="cat-icon">{{.Icon}}</div>
                    <div class="cat-name">{{.Name}}</div>
                    <div class="cat-score {{.GradeClass}}">{{.Score}}</div>
                    <div class="cat-grade">ã‚°ãƒ¬ãƒ¼ãƒ‰ {{.Grade}}</div>
                    <div class="cat-diagnosis">{{.Diagnosis}}</div>
                </div>
                {{end}}
            </div>
        </section>

        <!-- Risks Summary (ã‚«ãƒ†ã‚´ãƒªè¨ºæ–­ã®çµæœã¾ã¨ã‚) -->
        {{if .HasRisks}}
        <section class="section">
            <h2>ğŸš¨ æ¤œå‡ºã•ã‚ŒãŸãƒªã‚¹ã‚¯ï¼ˆ{{len .Risks}}ä»¶ï¼‰</h2>
            <div class="risks-list">
                {{range .Risks}}
                <div class="risk-item {{.Severity}}">
                    <span class="risk-icon">{{.SeverityIcon}}</span>
                    <div class="risk-content">
                        <h4>{{.Type}}</h4>
                        <p>{{.Description}}</p>
                        {{if .Target}}<p><strong>å¯¾è±¡:</strong> {{.Target}}</p>{{end}}
                        <p class="risk-action">ğŸ’¡ {{.Action}}</p>
                    </div>
                </div>
                {{end}}
            </div>
        </section>
        {{end}}

        <!-- Level 3: Expandable Detail Sections -->

        <!-- ğŸ“ˆ é–‹ç™ºé€Ÿåº¦ -->
        <details class="section-details">
        <summary class="section-summary">
            {{range .Categories}}{{if eq .CategoryID "velocity"}}
            <span class="cat-icon">{{.Icon}}</span>
            <span class="summary-name">{{.Name}}</span>
            <span class="cat-score-badge {{.GradeClass}}">{{.Score}} / {{.Grade}}</span>
            {{end}}{{end}}
        </summary>
        <section class="category-section" style="box-shadow:none; margin:0; padding: 20px 30px;">
            {{range .Categories}}{{if eq .CategoryID "velocity"}}
            <p class="category-diagnosis">{{.Diagnosis}}</p>
            {{end}}{{end}}

            <!-- ã‚¹ã‚³ã‚¢å†…è¨³ -->
            {{range .Categories}}{{if eq .CategoryID "velocity"}}
            {{if .Breakdown}}
            <div class="score-breakdown" style="margin-bottom: 20px;">
                <h4 style="font-size: 0.9rem; color: #667eea; margin-bottom: 8px;">ã‚¹ã‚³ã‚¢å†…è¨³</h4>
                <table>
                    {{range .Breakdown}}
                    <tr class="{{if gt .Points 0}}positive{{else if lt .Points 0}}negative{{end}}">
                        <td>{{.Label}}</td>
                        <td class="points">{{if gt .Points 0}}+{{end}}{{.Points}}</td>
                    </tr>
                    {{if .Detail}}<tr><td colspan="2" class="detail">{{.Detail}}</td></tr>{{end}}
                    {{end}}
                </table>
            </div>
            {{end}}
            {{end}}{{end}}

            <!-- PRãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ  -->
            <details class="metric-detail" data-chart="leadtime">
                <summary>
                    <span class="metric-name">PRãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ </span>
                    <span class="metric-value {{if ge .AvgLeadTime 7.0}}warning{{end}}">{{printf "%.1f" .AvgLeadTime}}æ—¥</span>
                    <span class="metric-status">{{if ge .AvgLeadTime 7.0}}ğŸŸ¡{{else if ge .AvgLeadTime 3.0}}ğŸŸ¢{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>PRä½œæˆã‹ã‚‰ãƒãƒ¼ã‚¸ã¾ã§ã®å¹³å‡æ—¥æ•°ã¯ <strong>{{printf "%.1f" .AvgLeadTime}}æ—¥</strong> ã§ã™ã€‚åŸºæº–: 3æ—¥ä»¥ä¸‹ãŒè‰¯å¥½ / 7æ—¥ä»¥ä¸Šã§è­¦å‘Šã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š PRåˆ¥ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ </h4>
                        <div class="detail-chart"><canvas id="chart-leadtime"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ”¥ æ”¾ç½®ã™ã‚‹ã¨ï¼Ÿ</h4>
                        <ul>
                            <li>ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒé »ç™ºã™ã‚‹</li>
                            <li>é–‹ç™ºè€…ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½ä¸‹</li>
                            <li>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¤ãƒƒãƒãŒå¢—ãˆã‚‹</li>
                        </ul>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>PRã‚’å°ã•ãåˆ†å‰²ã™ã‚‹ï¼ˆ200è¡Œä»¥ä¸‹ç›®æ¨™ï¼‰</li>
                            <li>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æ˜ç¢ºåŒ–</li>
                            <li>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ç¢ºä¿</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- ã‚³ãƒŸãƒƒãƒˆé »åº¦ -->
            <details class="metric-detail" data-chart="commits">
                <summary>
                    <span class="metric-name">ã‚³ãƒŸãƒƒãƒˆé »åº¦</span>
                    <span class="metric-value">{{printf "%.2f" .FeatureAddition}}/æ—¥</span>
                    <span class="metric-status">{{if ge .FeatureAddition 2.0}}ğŸŸ¢{{else if ge .FeatureAddition 0.5}}ğŸŸ¢{{else}}ğŸŸ¡{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>1æ—¥ã‚ãŸã‚Šå¹³å‡ <strong>{{printf "%.2f" .FeatureAddition}}</strong> ã‚³ãƒŸãƒƒãƒˆã§ã™ã€‚åŸºæº–: 2ä»¥ä¸ŠãŒæ´»ç™º / 0.5æœªæº€ã§ä½èª¿ã€‚æœŸé–“ä¸­ã®ç·ã‚³ãƒŸãƒƒãƒˆæ•°: {{.TotalCommits}}ä»¶ã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š æ—¥åˆ¥ã‚³ãƒŸãƒƒãƒˆæ¨ç§»</h4>
                        <div class="detail-chart"><canvas id="chart-daily-commits"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>æ¥µç«¯ã«å°‘ãªã„å ´åˆ: é–‹ç™ºãŒåœæ»ã—ã¦ã„ã‚‹å¯èƒ½æ€§</li>
                            <li>æ€¥æ¿€ãªå¢—åŠ : ãƒªãƒªãƒ¼ã‚¹å‰ã®é§†ã‘è¾¼ã¿ã‹ã‚‚</li>
                            <li>é€±æœ«ã«å¤šã„: éè² è·ã®å…†å€™</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡æ™‚é–“ -->
            <details class="metric-detail" data-chart="reviewwait">
                <summary>
                    <span class="metric-name">ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡æ™‚é–“</span>
                    <span class="metric-value {{if ge .AvgReviewWaitTime 48.0}}warning{{end}}">{{printf "%.1f" .AvgReviewWaitTime}}h</span>
                    <span class="metric-status">{{if ge .AvgReviewWaitTime 48.0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>PRä½œæˆã‹ã‚‰æœ€åˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¾ã§ã®å¹³å‡æ™‚é–“ã¯ <strong>{{printf "%.1f" .AvgReviewWaitTime}}æ™‚é–“</strong> ã§ã™ã€‚åŸºæº–: 24hä»¥å†…ãŒè‰¯å¥½ / 48hä»¥ä¸Šã§è­¦å‘Šã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š PRåˆ¥ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡æ™‚é–“</h4>
                        <div class="detail-chart"><canvas id="chart-reviewwait"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“è€…ã‚’PRä½œæˆæ™‚ã«æŒ‡å®š</li>
                            <li>Slackã¸ã®é€šçŸ¥ã§è¦‹é€ƒã—é˜²æ­¢</li>
                            <li>æ¯æ—¥ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ ã‚’ç¢ºä¿ï¼ˆæœä¸€ç•ªãªã©ï¼‰</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- ã‚ªãƒ¼ãƒ—ãƒ³ PR/Issue -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">ã‚ªãƒ¼ãƒ—ãƒ³ PR/Issue</span>
                    <span class="metric-value">{{.OpenPRCount}} / {{.OpenIssueCount}}</span>
                    <span class="metric-status">ğŸ”µ</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>ç¾åœ¨ã‚ªãƒ¼ãƒ—ãƒ³ä¸­: PR <strong>{{.OpenPRCount}}ä»¶</strong> / Issue <strong>{{.OpenIssueCount}}ä»¶</strong>ã€‚æ»ç•™ã‚¿ã‚¹ã‚¯ã®é‡ã‚’ç¤ºã—ã¾ã™ã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>é€±æ¬¡ã§ã‚ªãƒ¼ãƒ—ãƒ³æ•°ã‚’ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</li>
                            <li>å¤ã„PR/Issueã¯å®šæœŸçš„ã«ãƒˆãƒªã‚¢ãƒ¼ã‚¸</li>
                            <li>å„ªå…ˆåº¦ãƒ©ãƒ™ãƒ«ã‚’æ´»ç”¨ã—ã¦æ•´ç†</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- DORA: ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ (DORA)</span>
                    <span class="metric-value">{{printf "%.1f" .DeployFrequency}}/æœˆ</span>
                    <span class="metric-status dora-badge dora-{{lower .DeployFreqRating}}">{{.DeployFreqRating}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>æœŸé–“ä¸­ã®ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ã¯ <strong>æœˆ{{printf "%.1f" .DeployFrequency}}å›</strong> ã§ã™ã€‚DORAãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: <strong>{{.DeployFreqRating}}</strong>ï¼ˆElite: æ¯æ—¥ / High: é€±1å› / Medium: æœˆ1å› / Low: æœˆ1å›æœªæº€ï¼‰</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ•´å‚™ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</li>
                            <li>å°ã•ãªãƒªãƒªãƒ¼ã‚¹ã‚’é »ç¹ã«è¡Œã†æ–‡åŒ–ã‚’æ§‹ç¯‰</li>
                            <li>ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã§ãƒªã‚¹ã‚¯ã‚’è»½æ¸›</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- DORA: MTTR -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">å¹³å‡å¾©æ—§æ™‚é–“ (DORA)</span>
                    <span class="metric-value">{{printf "%.1f" .MTTR}}h</span>
                    <span class="metric-status dora-badge dora-{{lower .MTTRRating}}">{{.MTTRRating}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>éšœå®³ã‹ã‚‰ã®å¹³å‡å¾©æ—§æ™‚é–“ã¯ <strong>{{printf "%.1f" .MTTR}}æ™‚é–“</strong> ã§ã™ã€‚DORAãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: <strong>{{.MTTRRating}}</strong>ï¼ˆElite: 1hæœªæº€ / High: 24hæœªæº€ / Medium: 1é€±é–“æœªæº€ / Low: 1é€±é–“ä»¥ä¸Šï¼‰</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’è‡ªå‹•åŒ–ã™ã‚‹</li>
                            <li>ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã®ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’æ•´å‚™</li>
                            <li>éšœå®³æ¤œçŸ¥ã®è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®š</li>
                        </ul>
                    </div>
                </div>
            </details>
        </section>
        </details>

        <!-- âœ… ã‚³ãƒ¼ãƒ‰å“è³ª -->
        <details class="section-details">
        <summary class="section-summary">
            {{range .Categories}}{{if eq .CategoryID "quality"}}
            <span class="cat-icon">{{.Icon}}</span>
            <span class="summary-name">{{.Name}}</span>
            <span class="cat-score-badge {{.GradeClass}}">{{.Score}} / {{.Grade}}</span>
            {{end}}{{end}}
        </summary>
        <section class="category-section" style="box-shadow:none; margin:0; padding: 20px 30px;">
            {{range .Categories}}{{if eq .CategoryID "quality"}}
            <p class="category-diagnosis">{{.Diagnosis}}</p>
            {{end}}{{end}}

            <!-- ã‚¹ã‚³ã‚¢å†…è¨³ -->
            {{range .Categories}}{{if eq .CategoryID "quality"}}
            {{if .Breakdown}}
            <div class="score-breakdown" style="margin-bottom: 20px;">
                <h4 style="font-size: 0.9rem; color: #667eea; margin-bottom: 8px;">ã‚¹ã‚³ã‚¢å†…è¨³</h4>
                <table>
                    {{range .Breakdown}}
                    <tr class="{{if gt .Points 0}}positive{{else if lt .Points 0}}negative{{end}}">
                        <td>{{.Label}}</td>
                        <td class="points">{{if gt .Points 0}}+{{end}}{{.Points}}</td>
                    </tr>
                    {{if .Detail}}<tr><td colspan="2" class="detail">{{.Detail}}</td></tr>{{end}}
                    {{end}}
                </table>
            </div>
            {{end}}
            {{end}}{{end}}

            <!-- ãƒã‚°ä¿®æ­£å‰²åˆ â†’ æŠ•è³‡æ¯”ç‡ (4åˆ†é¡) -->
            <details class="metric-detail" data-chart="bugfix">
                <summary>
                    <span class="metric-name">æŠ•è³‡æ¯”ç‡ï¼ˆPRåˆ†é¡ï¼‰</span>
                    <span class="metric-value {{if ge .BugFixRatio 50.0}}warning{{end}}">Feature {{printf "%.0f" .FeatureRatio}}%</span>
                    <span class="metric-status">{{if ge .BugFixRatio 50.0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>ãƒãƒ¼ã‚¸æ¸ˆã¿PRã®æŠ•è³‡æ¯”ç‡: Feature <strong>{{.FeaturePRCount}}ä»¶ ({{printf "%.1f" .FeatureRatio}}%)</strong> / BugFix <strong>{{.BugFixPRCount}}ä»¶ ({{printf "%.1f" .BugFixRatio}}%)</strong> / Refactor <strong>{{.RefactorPRCount}}ä»¶ ({{printf "%.1f" .RefactorRatio}}%)</strong> / Other <strong>{{.OtherPRCount}}ä»¶</strong>ã€‚æ©Ÿèƒ½è¿½åŠ 30%ä»¥ä¸ŠãŒç›®å®‰ã§ã™ã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š PRç¨®åˆ¥å†…è¨³</h4>
                        <div class="detail-chart"><canvas id="chart-bugfix"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ãƒ†ã‚¹ãƒˆã‚’å……å®Ÿã•ã›ã¦ãƒã‚°ã‚’äº‹å‰ã«é˜²ã</li>
                            <li>æŠ€è¡“çš„è² å‚µã®è¿”æ¸ˆã¨æ©Ÿèƒ½é–‹ç™ºã®ãƒãƒ©ãƒ³ã‚¹ã‚’è¦‹ç›´ã™</li>
                            <li>ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®æ™‚é–“ã‚’è¨ˆç”»çš„ã«ç¢ºä¿ã™ã‚‹</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- DORA: å¤‰æ›´å¤±æ•—ç‡ -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">å¤‰æ›´å¤±æ•—ç‡ (DORA)</span>
                    <span class="metric-value {{if ge .ChangeFailureRate 30.0}}warning{{end}}">{{printf "%.1f" .ChangeFailureRate}}%</span>
                    <span class="metric-status dora-badge dora-{{lower .ChangeFailRating}}">{{.ChangeFailRating}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>å¤‰æ›´å¤±æ•—ç‡ã¯ <strong>{{printf "%.1f" .ChangeFailureRate}}%</strong> ã§ã™ã€‚DORAãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: <strong>{{.ChangeFailRating}}</strong>ï¼ˆElite: 15%ä»¥ä¸‹ / High: 30%ä»¥ä¸‹ / Medium: 45%ä»¥ä¸‹ / Low: 45%è¶…ï¼‰</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ãƒªãƒªãƒ¼ã‚¹å‰ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚’å¼·åŒ–</li>
                            <li>ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®æ¤œè¨¼ã‚’å¾¹åº•</li>
                            <li>ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã§ãƒªã‚¹ã‚¯ã‚’è»½æ¸›</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- ã‚³ãƒ¼ãƒ‰ãƒãƒ£ãƒ¼ãƒ³ (Revertç‡) -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">ã‚³ãƒ¼ãƒ‰ãƒãƒ£ãƒ¼ãƒ³ï¼ˆRevertç‡ï¼‰</span>
                    <span class="metric-value {{if ge .RevertRate 5.0}}warning{{end}}">{{printf "%.1f" .RevertRate}}%</span>
                    <span class="metric-status">{{if ge .RevertRate 5.0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>Revertã‚³ãƒŸãƒƒãƒˆãŒ <strong>{{.RevertCommitCount}}ä»¶</strong>ï¼ˆå…¨ä½“ã®{{printf "%.1f" .RevertRate}}%ï¼‰ã§ã™ã€‚æ‰‹æˆ»ã‚Šã®å¤šã•ã‚’ç¤ºã—ã¾ã™ã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å“è³ªã‚’å‘ä¸Šã•ã›ã‚‹</li>
                            <li>è‡ªå‹•ãƒ†ã‚¹ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ä¸Šã’ã‚‹</li>
                            <li>å°ã•ãªå¤‰æ›´ã‚’é »ç¹ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- å¤‰æ›´é›†ä¸­ -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">å¤‰æ›´é›†ä¸­ï¼ˆãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆï¼‰</span>
                    <span class="metric-value">{{len .ChangeConcentrationRisks}}ä»¶</span>
                    <span class="metric-status">{{if gt (len .ChangeConcentrationRisks) 0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>çŸ­æœŸé–“ã«é›†ä¸­ã—ã¦å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ <strong>{{len .ChangeConcentrationRisks}}ä»¶</strong> æ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚</p>
                    </div>
                    {{if .ChangeConcentrationRisks}}
                    <div class="detail-section">
                        <h4>ğŸ“ ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆä¸€è¦§</h4>
                        <table class="detail-table">
                            <thead><tr><th>ãƒªã‚¹ã‚¯</th><th>ãƒ•ã‚¡ã‚¤ãƒ«</th><th>èª¬æ˜</th></tr></thead>
                            <tbody>
                                {{range .ChangeConcentrationRisks}}
                                <tr>
                                    <td class="risk-icon">{{.SeverityIcon}}</td>
                                    <td class="file-path">{{.Target}}</td>
                                    <td>{{.Description}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>é »ç¹ã«å¤‰æ›´ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®è²¬å‹™ã‚’åˆ†å‰²ã™ã‚‹</li>
                            <li>å¤‰æ›´ã®åŸå› ã‚’èª¿æŸ»ã—ã€è¨­è¨ˆã‚’è¦‹ç›´ã™</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- PRã‚µã‚¤ã‚º -->
            <details class="metric-detail" data-chart="prsize">
                <summary>
                    <span class="metric-name">å¹³å‡PRã‚µã‚¤ã‚º</span>
                    <span class="metric-value {{if geInt .AvgPRSize 500}}warning{{end}}">{{.AvgPRSize}}è¡Œ</span>
                    <span class="metric-status">{{if geInt .AvgPRSize 500}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>PRã‚ãŸã‚Šã®å¹³å‡å¤‰æ›´è¡Œæ•°ã¯ <strong>{{.AvgPRSize}}è¡Œ</strong> ã§ã™ã€‚åŸºæº–: 200è¡Œä»¥ä¸‹ãŒè‰¯å¥½ / 500è¡Œä»¥ä¸Šã§è­¦å‘Šã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š PRåˆ¥å¤‰æ›´è¡Œæ•°</h4>
                        <div class="detail-chart"><canvas id="chart-prsize"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>1ã¤ã®PRã§1ã¤ã®æ©Ÿèƒ½/ä¿®æ­£ã«çµã‚‹</li>
                            <li>ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨æ©Ÿèƒ½è¿½åŠ ã‚’åˆ†ã‘ã‚‹</li>
                            <li>ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã§å¤§ããªæ©Ÿèƒ½ã‚’å°åˆ†ã‘ã«ãƒªãƒªãƒ¼ã‚¹</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- Issueã‚¯ãƒ­ãƒ¼ã‚ºç‡ -->
            <details class="metric-detail" data-chart="issueclose">
                <summary>
                    <span class="metric-name">Issueã‚¯ãƒ­ãƒ¼ã‚ºç‡</span>
                    <span class="metric-value {{if and (gt .IssuesCreated 0) (ltFloat .IssueCloseRate 50.0)}}warning{{end}}">{{printf "%.1f" .IssueCloseRate}}%</span>
                    <span class="metric-status">{{if and (gt .IssuesCreated 0) (ltFloat .IssueCloseRate 50.0)}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>æœŸé–“ä¸­ã®ä½œæˆ: <strong>{{.IssuesCreated}}ä»¶</strong> / ã‚¯ãƒ­ãƒ¼ã‚º: <strong>{{.IssuesClosed}}ä»¶</strong>ï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºç‡ {{printf "%.1f" .IssueCloseRate}}%ï¼‰ã€‚åŸºæº–: 100%ä»¥ä¸ŠãŒè‰¯å¥½ / 50%ä»¥ä¸‹ã§è­¦å‘Šã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š ä½œæˆ vs ã‚¯ãƒ­ãƒ¼ã‚º</h4>
                        <div class="detail-chart"><canvas id="chart-issueclose"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>å®šæœŸçš„ãªãƒˆãƒªã‚¢ãƒ¼ã‚¸ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§å„ªå…ˆåº¦ã‚’æ•´ç†</li>
                            <li>å¯¾å¿œã—ãªã„ã‚‚ã®ã¯ã€Œwontfixã€ã§ã‚¯ãƒ­ãƒ¼ã‚º</li>
                            <li>100%ä»¥ä¸Šã‚’ç¶­æŒï¼ˆæ¶ˆåŒ–ãŒè¿½ã„ã¤ãçŠ¶æ…‹ï¼‰</li>
                        </ul>
                    </div>
                </div>
            </details>
        </section>
        </details>

        <!-- âš ï¸ æŠ€è¡“çš„è² å‚µ -->
        <details class="section-details">
        <summary class="section-summary">
            {{range .Categories}}{{if eq .CategoryID "tech_debt"}}
            <span class="cat-icon">{{.Icon}}</span>
            <span class="summary-name">{{.Name}}</span>
            <span class="cat-score-badge {{.GradeClass}}">{{.Score}} / {{.Grade}}</span>
            {{end}}{{end}}
        </summary>
        <section class="category-section" style="box-shadow:none; margin:0; padding: 20px 30px;">
            {{range .Categories}}{{if eq .CategoryID "tech_debt"}}
            <p class="category-diagnosis">{{.Diagnosis}}</p>
            {{end}}{{end}}

            <!-- ã‚¹ã‚³ã‚¢å†…è¨³ -->
            {{range .Categories}}{{if eq .CategoryID "tech_debt"}}
            {{if .Breakdown}}
            <div class="score-breakdown" style="margin-bottom: 20px;">
                <h4 style="font-size: 0.9rem; color: #667eea; margin-bottom: 8px;">ã‚¹ã‚³ã‚¢å†…è¨³</h4>
                <table>
                    {{range .Breakdown}}
                    <tr class="{{if gt .Points 0}}positive{{else if lt .Points 0}}negative{{end}}">
                        <td>{{.Label}}</td>
                        <td class="points">{{if gt .Points 0}}+{{end}}{{.Points}}</td>
                    </tr>
                    {{if .Detail}}<tr><td colspan="2" class="detail">{{.Detail}}</td></tr>{{end}}
                    {{end}}
                </table>
            </div>
            {{end}}
            {{end}}{{end}}

            <!-- å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ« -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«</span>
                    <span class="metric-value {{if gt .LargeFileCount 0}}warning{{end}}">{{.LargeFileCount}}ä»¶</span>
                    <span class="metric-status">{{if gt .LargeFileCount 0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>50KBä»¥ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒ <strong>{{.LargeFileCount}}ä»¶</strong> ã‚ã‚Šã¾ã™ã€‚</p>
                    </div>
                    {{if .LargeFiles}}
                    <div class="detail-section">
                        <h4>ğŸ“ è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h4>
                        <table class="detail-table">
                            <thead><tr><th>ãƒªã‚¹ã‚¯</th><th>ãƒ•ã‚¡ã‚¤ãƒ«</th><th>ã‚µã‚¤ã‚º</th></tr></thead>
                            <tbody>
                                {{range .LargeFiles}}
                                <tr>
                                    <td class="risk-icon">{{if eq .SeverityStr "high"}}ğŸ”´{{else}}ğŸŸ¡{{end}}</td>
                                    <td class="file-path">{{.Path}}</td>
                                    <td class="file-size">{{.SizeKB}}KB</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>è²¬å‹™ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹</li>
                            <li>å…±é€šå‡¦ç†ã‚’åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æŠ½å‡º</li>
                            <li>100KBä»¥ä¸Šã¯å„ªå…ˆçš„ã«å¯¾å¿œ</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- å¤ã„ä¾å­˜ -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">å¤ã„ä¾å­˜</span>
                    <span class="metric-value {{if gt .OutdatedDepCount 0}}warning{{end}}">{{.OutdatedDepCount}}ä»¶</span>
                    <span class="metric-status">{{if gt .OutdatedDepCount 0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>2å¹´ä»¥ä¸Šå‰ã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ <strong>{{.OutdatedDepCount}}ä»¶</strong> ã‚ã‚Šã¾ã™ã€‚</p>
                    </div>
                    {{if .OutdatedDeps}}
                    <div class="detail-section">
                        <h4>ğŸ“ è©²å½“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§</h4>
                        <table class="detail-table">
                            <thead><tr><th>ãƒªã‚¹ã‚¯</th><th>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</th><th>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</th><th>çµŒé</th></tr></thead>
                            <tbody>
                                {{range .OutdatedDeps}}
                                <tr>
                                    <td class="risk-icon">{{if eq .SeverityStr "high"}}ğŸ”´{{else}}ğŸŸ¡{{end}}</td>
                                    <td class="file-path">{{.Name}}</td>
                                    <td>{{.Version}}</td>
                                    <td class="file-size">{{.Age}}</td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>Dependabot ã‚„ Renovate ã‚’å°å…¥ã—ã¦è‡ªå‹•æ›´æ–°</li>
                            <li>3å¹´ä»¥ä¸Šã®ã‚‚ã®ã¯å„ªå…ˆçš„ã«å¯¾å¿œ</li>
                            <li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®šæœŸå®Ÿè¡Œ</li>
                        </ul>
                    </div>
                </div>
            </details>
        </section>
        </details>

        <!-- ğŸ’š ãƒãƒ¼ãƒ å¥å…¨æ€§ -->
        <details class="section-details">
        <summary class="section-summary">
            {{range .Categories}}{{if eq .CategoryID "health"}}
            <span class="cat-icon">{{.Icon}}</span>
            <span class="summary-name">{{.Name}}</span>
            <span class="cat-score-badge {{.GradeClass}}">{{.Score}} / {{.Grade}}</span>
            {{end}}{{end}}
        </summary>
        <section class="category-section" style="box-shadow:none; margin:0; padding: 20px 30px;">
            {{range .Categories}}{{if eq .CategoryID "health"}}
            <p class="category-diagnosis">{{.Diagnosis}}</p>
            {{end}}{{end}}

            <!-- ã‚¹ã‚³ã‚¢å†…è¨³ -->
            {{range .Categories}}{{if eq .CategoryID "health"}}
            {{if .Breakdown}}
            <div class="score-breakdown" style="margin-bottom: 20px;">
                <h4 style="font-size: 0.9rem; color: #667eea; margin-bottom: 8px;">ã‚¹ã‚³ã‚¢å†…è¨³</h4>
                <table>
                    {{range .Breakdown}}
                    <tr class="{{if gt .Points 0}}positive{{else if lt .Points 0}}negative{{end}}">
                        <td>{{.Label}}</td>
                        <td class="points">{{if gt .Points 0}}+{{end}}{{.Points}}</td>
                    </tr>
                    {{if .Detail}}<tr><td colspan="2" class="detail">{{.Detail}}</td></tr>{{end}}
                    {{end}}
                </table>
            </div>
            {{end}}
            {{end}}{{end}}

            <!-- æ·±å¤œåŠ´åƒç‡ -->
            <details class="metric-detail" data-chart="latenight">
                <summary>
                    <span class="metric-name">æ·±å¤œåŠ´åƒç‡</span>
                    <span class="metric-value {{if ge .LateNightRate 30.0}}warning{{end}}">{{printf "%.1f" .LateNightRate}}%</span>
                    <span class="metric-status">{{if ge .LateNightRate 30.0}}ğŸŸ¡{{else}}ğŸŸ¢{{end}}</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>22:00ã€œç¿Œ5:00ã®ã‚³ãƒŸãƒƒãƒˆå‰²åˆã¯ <strong>{{printf "%.1f" .LateNightRate}}%</strong> ã§ã™ã€‚åŸºæº–: 10%ä»¥ä¸‹ãŒè‰¯å¥½ / 30%ä»¥ä¸Šã§è­¦å‘Šã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š æ™‚é–“å¸¯åˆ¥ã‚³ãƒŸãƒƒãƒˆåˆ†å¸ƒ</h4>
                        <div class="detail-chart"><canvas id="chart-latenight"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ã‚¹ãƒ—ãƒªãƒ³ãƒˆã®ä½œæ¥­é‡ã‚’è¦‹ç›´ã™</li>
                            <li>äººå“¡ã‚’å¢—ã‚„ã™ or ä½œæ¥­ã‚’åˆ†æ•£ã™ã‚‹</li>
                            <li>æ—¥ä¸­ã®ä¼šè­°ã‚’æ¸›ã‚‰ã—ã€é›†ä¸­ã‚¿ã‚¤ãƒ ã‚’ç¢ºä¿</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- ãƒªãƒã‚¸ãƒˆãƒªè¦æ¨¡ -->
            <details class="metric-detail">
                <summary>
                    <span class="metric-name">ãƒªãƒã‚¸ãƒˆãƒªè¦æ¨¡</span>
                    <span class="metric-value">{{.TotalFiles}}ãƒ•ã‚¡ã‚¤ãƒ« / {{.Contributors}}äºº</span>
                    <span class="metric-status">ğŸ”µ</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>ãƒªãƒã‚¸ãƒˆãƒªã®ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã¯ <strong>{{.TotalFiles}}ä»¶</strong>ã€ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼æ•°ã¯ <strong>{{.Contributors}}äºº</strong> ã§ã™ã€‚1äººã‚ãŸã‚Šã®è² æ‹…é‡ã®ç›®å®‰ã«ãªã‚Šã¾ã™ã€‚</p>
                    </div>
                </div>
            </details>

            <!-- å±äººåŒ–ï¼ˆã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼åˆ†å¸ƒï¼‰ -->
            <details class="metric-detail" data-chart="contributors">
                <summary>
                    <span class="metric-name">ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼åˆ†å¸ƒ</span>
                    <span class="metric-value">{{.Contributors}}äºº</span>
                    <span class="metric-status">ğŸ”µ</span>
                </summary>
                <div class="detail-content">
                    <div class="detail-section">
                        <h4>ğŸ“‹ è¨ºæ–­</h4>
                        <p>ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼æ•°: <strong>{{.Contributors}}äºº</strong>ã€‚å¤šã„ã»ã©å±äººåŒ–ãƒªã‚¹ã‚¯ãŒä½ãã€çŸ¥è­˜ãŒåˆ†æ•£ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ“Š ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ãƒ¼åˆ¥ã‚³ãƒŸãƒƒãƒˆæ•°</h4>
                        <div class="detail-chart"><canvas id="chart-contributors"></canvas></div>
                    </div>
                    <div class="detail-section">
                        <h4>ğŸ’¡ æ”¹å–„ææ¡ˆ</h4>
                        <ul>
                            <li>ãƒšã‚¢ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚„ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§çŸ¥è­˜ã‚’åˆ†æ•£</li>
                            <li>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ•´å‚™ã—ã¦å‚å…¥éšœå£ã‚’ä¸‹ã’ã‚‹</li>
                            <li>1äººãŒ80%ä»¥ä¸Šã®ã‚³ãƒŸãƒƒãƒˆ â†’ å±äººåŒ–ãƒªã‚¹ã‚¯</li>
                        </ul>
                    </div>
                </div>
            </details>
        </section>
        </details>

        <!-- ãƒˆãƒ¬ãƒ³ãƒ‰æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <details class="section-details">
        <summary class="section-summary">
            <span class="cat-icon">ğŸ“Š</span>
            <span class="summary-name">å‰æœŸæ¯”è¼ƒãƒˆãƒ¬ãƒ³ãƒ‰</span>
        </summary>
        <section class="section" style="box-shadow:none; margin:0;">
            <div class="trend-section" id="trend-container"></div>
        </section>
        </details>

        <!-- AI Analysis Section -->
        <!-- ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯AIï¼ˆClaude Codeç­‰ï¼‰ãŒãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã¿å–ã‚Šã€åˆ†æã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½è¨˜ã™ã‚‹å ´æ‰€ã§ã™ã€‚ -->
        <!-- è¿½è¨˜ãƒ«ãƒ¼ãƒ«: <div id="ai-comments"> ã®ä¸­ã«HTMLã‚’è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚ -->
        <section class="section" id="ai-analysis">
            <h2>ğŸ¤– AI åˆ†æã‚³ãƒ¡ãƒ³ãƒˆ</h2>
            <div id="ai-comments">
                <p style="color: #999; font-style: italic;">ã¾ã AIåˆ†æã¯å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
            </div>
            <p style="color: #bbb; font-size: 0.8rem; margin-top: 16px;">ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯AIã«ã‚ˆã‚‹è‡ªå‹•åˆ†æã§ã™ã€‚å†…å®¹ã¯å‚è€ƒæƒ…å ±ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
        </section>
    </div>

    <footer>
        <p>Lokup - GitHub ãƒªãƒã‚¸ãƒˆãƒªå¥åº·è¨ºæ–­ãƒ„ãƒ¼ãƒ«</p>
    </footer>

    <script>
        // Drill-down data (injected from Go template)
        const prDetails = {{.PRDetailsJSON}};
        const contributorDetails = {{.ContributorDetailsJSON}};
        const hourlyCommits = {{.HourlyCommitsJSON}};
        const trendsData = {{.TrendsJSON}};
        const commitsByDay = [{{range $i, $c := .CommitsByDay}}{{if $i}},{{end}}{{$c}}{{end}}];
        const commitDayLabels = [{{range $i, $l := .CommitDayLabels}}{{if $i}},{{end}}'{{$l}}'{{end}}];

        // Chart creation functions
        function createLeadTimeChart(canvas) {
            const data = prDetails.filter(pr => pr.leadTimeDays >= 0);
            if (data.length === 0) return;
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: data.map(pr => '#' + pr.number),
                    datasets: [{
                        label: 'ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ  (æ—¥)',
                        data: data.map(pr => pr.leadTimeDays.toFixed(1)),
                        backgroundColor: data.map(pr =>
                            pr.leadTimeDays > 7 ? 'rgba(239,68,68,0.7)' :
                            pr.leadTimeDays > 3 ? 'rgba(234,179,8,0.7)' :
                            'rgba(34,197,94,0.7)'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'æ—¥æ•°' } } }
                }
            });
        }

        function createDailyCommitsChart(canvas) {
            new Chart(canvas, {
                type: 'line',
                data: {
                    labels: commitDayLabels,
                    datasets: [{
                        label: 'ã‚³ãƒŸãƒƒãƒˆæ•°',
                        data: commitsByDay,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true, tension: 0.3, pointRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        }

        function createReviewWaitChart(canvas) {
            const data = prDetails.filter(pr => pr.reviewWaitHours > 0);
            if (data.length === 0) return;
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: data.map(pr => '#' + pr.number),
                    datasets: [{
                        label: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ (æ™‚é–“)',
                        data: data.map(pr => pr.reviewWaitHours.toFixed(1)),
                        backgroundColor: data.map(pr =>
                            pr.reviewWaitHours > 48 ? 'rgba(239,68,68,0.7)' :
                            pr.reviewWaitHours > 24 ? 'rgba(234,179,8,0.7)' :
                            'rgba(34,197,94,0.7)'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'æ™‚é–“' } } }
                }
            });
        }

        function createBugFixChart(canvas) {
            new Chart(canvas, {
                type: 'doughnut',
                data: {
                    labels: ['Feature', 'BugFix', 'Refactor', 'Other'],
                    datasets: [{
                        data: [{{.FeaturePRCount}}, {{.BugFixPRCount}}, {{.RefactorPRCount}}, {{.OtherPRCount}}],
                        backgroundColor: ['rgba(59,130,246,0.8)', 'rgba(239,68,68,0.8)', 'rgba(234,179,8,0.8)', 'rgba(156,163,175,0.8)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function createPRSizeChart(canvas) {
            const data = prDetails.filter(pr => pr.size > 0);
            if (data.length === 0) return;
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: data.map(pr => '#' + pr.number),
                    datasets: [{
                        label: 'å¤‰æ›´è¡Œæ•°',
                        data: data.map(pr => pr.size),
                        backgroundColor: data.map(pr =>
                            pr.size > 500 ? 'rgba(239,68,68,0.7)' :
                            pr.size > 200 ? 'rgba(234,179,8,0.7)' :
                            'rgba(34,197,94,0.7)'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true, title: { display: true, text: 'è¡Œæ•°' } } }
                }
            });
        }

        function createIssueCloseChart(canvas) {
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: ['Issue'],
                    datasets: [
                        {
                            label: 'ä½œæˆ',
                            data: [{{.IssuesCreated}}],
                            backgroundColor: 'rgba(59,130,246,0.8)',
                            borderRadius: 4
                        },
                        {
                            label: 'ã‚¯ãƒ­ãƒ¼ã‚º',
                            data: [{{.IssuesClosed}}],
                            backgroundColor: 'rgba(34,197,94,0.8)',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function createLateNightChart(canvas) {
            const labels = Array.from({length: 24}, (_, i) => i + 'æ™‚');
            const isLateNight = (h) => h >= 22 || h < 5;
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ã‚³ãƒŸãƒƒãƒˆæ•°',
                        data: hourlyCommits,
                        backgroundColor: hourlyCommits.map((_, i) =>
                            isLateNight(i) ? 'rgba(239,68,68,0.7)' : 'rgba(59,130,246,0.7)'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        }

        function createContributorsChart(canvas) {
            if (contributorDetails.length === 0) return;
            const top10 = contributorDetails.slice(0, 10);
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: top10.map(c => c.name),
                    datasets: [{
                        label: 'ã‚³ãƒŸãƒƒãƒˆæ•°',
                        data: top10.map(c => c.commits),
                        backgroundColor: top10.map(c =>
                            c.ratio > 80 ? 'rgba(239,68,68,0.7)' : 'rgba(59,130,246,0.7)'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        }

        // Chart type mapping
        const chartCreators = {
            'leadtime': createLeadTimeChart,
            'commits': createDailyCommitsChart,
            'reviewwait': createReviewWaitChart,
            'bugfix': createBugFixChart,
            'prsize': createPRSizeChart,
            'issueclose': createIssueCloseChart,
            'latenight': createLateNightChart,
            'contributors': createContributorsChart
        };

        // Lazy chart initialization on details toggle
        document.querySelectorAll('details.metric-detail').forEach(el => {
            el.addEventListener('toggle', () => {
                if (el.open && !el.dataset.initialized) {
                    const chartType = el.dataset.chart;
                    if (chartType && chartCreators[chartType]) {
                        const canvas = el.querySelector('canvas');
                        if (canvas) {
                            chartCreators[chartType](canvas);
                        }
                    }
                    el.dataset.initialized = 'true';
                }
            });
        });

        // Render trend items
        (function() {
            const container = document.getElementById('trend-container');
            if (!container || !trendsData || trendsData.length === 0) {
                if (container) container.innerHTML = '<p style="color:#999;font-size:0.9rem;">å‰æœŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            trendsData.forEach(t => {
                const arrow = t.direction === 'up' ? 'â†‘' : t.direction === 'down' ? 'â†“' : 'â†’';
                const sign = t.deltaPct >= 0 ? '+' : '';
                const item = document.createElement('div');
                item.className = 'trend-item';
                item.innerHTML = `
                    <span class="trend-arrow ${t.direction}">${arrow}</span>
                    <span class="trend-name">${t.metricName}</span>
                    <span class="trend-delta ${t.direction}">${sign}${t.deltaPct.toFixed(1)}%</span>
                `;
                container.appendChild(item);
            });
        })();
    </script>
</body>
</html>
