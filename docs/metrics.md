# メトリクス仕様

Lokup が計算・表示するメトリクスの詳細仕様。

## 設計思想

### 参考フレームワーク

Lokup のメトリクスは、業界標準フレームワークを参考に設計されている。

- **DORA Metrics**: Google が開発したDevOps性能指標
- **SPACE Framework**: Microsoft Research が開発した開発者生産性フレームワーク
- **Google Lighthouse**: 段階的開示（Progressive Disclosure）によるレポート構造

これらを基に、GitHub API から取得可能なデータで実用的な指標を提供する。

### レポート設計原則

Lokup のレポートは **「健康診断レポート」** のメタファーで設計する。

血液検査の数値を並べるだけでは患者は理解できない。
「総合判定 → カテゴリ判定 → 個別検査値 → 具体的な所見」の流れがあって初めて行動できる。

**情報の流れ:**
```
事実（数値） → 診断（何が問題か） → 影響（放置するとどうなるか） → 対策（何をすべきか）
```

**段階的開示（Progressive Disclosure）:**

読み手は最初に全体像を掴み、気になる部分だけ深掘りする。
Google Lighthouse や SonarQube が採用するこのパターンに従う。

```
Level 1: 総合グレード + 一行診断    ← 一瞬で全体の健全性を把握
Level 2: カテゴリカード + リスク     ← 4カテゴリの状態とリスクを確認
Level 3: カテゴリ詳細（展開式）      ← 各指標の値・チャート・テーブルで深掘り
```

---

## レポート構造

### ページ全体の構成

```
┌──────────────────────────────────────────────────────┐
│ HEADER                                               │
│   リポジトリ名、分析期間、生成日時                     │
├──────────────────────────────────────────────────────┤
│ LEVEL 1: 総合グレード（ヒーロー）                      │
│   ┌─────────────────────────────┐                    │
│   │         B                    │                    │
│   │   総合スコア: 72 / 100       │                    │
│   │   概ね良好ですが、技術的負債  │                    │
│   │   に改善の余地があります。    │                    │
│   └─────────────────────────────┘                    │
├──────────────────────────────────────────────────────┤
│ LEVEL 2: カテゴリカード（スコア + グレードのみ）       │
│   [開発速度: 72/B] [品質: 85/A] [負債: 45/C] [健全性: 68/B] │
├──────────────────────────────────────────────────────┤
│ リスク一覧（常に表示）                                │
│   🔴 巨大ファイル (326件) │ 🟡 古い依存 (15件) │ ... │
├──────────────────────────────────────────────────────┤
│ LEVEL 3: カテゴリ詳細（展開式 ×4）                    │
│                                                      │
│ ▶ 📈 開発速度 ─ 72/100 (B)                          │
│   └─ 展開すると:                                      │
│      ├─ スコア内訳テーブル                            │
│      ├─ ▶ PRリードタイム: 8.2日                      │
│      │   └─ 診断テキスト、チャート、Top5テーブル      │
│      ├─ ▶ コミット頻度: 2.80/日                      │
│      └─ ▶ レビュー待ち: 12.5h                        │
│                                                      │
│ ▶ 🛡️ コード品質 ─ 85/100 (A)                        │
│ ▶ 🏗️ 技術的負債 ─ 45/100 (C)                        │
│ ▶ 👥 チーム健全性 ─ 68/100 (B)                       │
│                                                      │
├──────────────────────────────────────────────────────┤
│ ▶ トレンド（展開式）                                  │
│   └─ 前期比較チャート                                 │
├──────────────────────────────────────────────────────┤
│ AI分析コメント                                        │
│   ヒーローインサイト → カード → アクション → 補足      │
│   （/analyze-report で追記）                          │
├──────────────────────────────────────────────────────┤
│ FOOTER                                               │
└──────────────────────────────────────────────────────┘
```

### メトリクスカードの構造

各メトリクスは `<details>/<summary>` による展開式カードで表示する。

```
閉じた状態:
┌─────────────────────────────────────────┐
│ ▶ PRリードタイム    8.2日    🟡 警告    │
└─────────────────────────────────────────┘

展開した状態:
┌─────────────────────────────────────────┐
│ ▼ PRリードタイム    8.2日    🟡 警告    │
├─────────────────────────────────────────┤
│                                         │
│ 📋 診断                                 │
│ PRがマージされるまで平均8.2日かかって    │
│ います。基準（3日以下）を大幅に超過。     │
│                                         │
│ 📊 分布チャート                          │
│ ┃                           ■ 15日      │
│ ┃          ■ 8日                        │
│ ┃ ■ 2日               ■ 5日            │
│ ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━     │
│  #101  #102  #103  #104                 │
│                                         │
│ 📝 遅いPR Top5                           │
│ | PR    | タイトル       | リードタイム  | │
│ | #103  | 大規模リファクタ | 15日        | │
│ | #102  | API変更        | 8日          | │
│ | ...                                   │
│                                         │
│ 🔥 放置すると？                          │
│ ・コンフリクトが頻発する                  │
│ ・開発者のモチベーションが低下            │
│                                         │
│ 💡 改善提案                              │
│ ・PRを小さく分割する（200行以下目標）     │
│ ・レビュー担当をローテーションで明確化     │
│ ・レビュー時間をカレンダーで確保           │
└─────────────────────────────────────────┘
```

### カテゴリヘッダーの構造

各カテゴリセクションの先頭にスコアと一行診断を表示。

```
┌─────────────────────────────────────────┐
│ 📈 開発速度    72/100 グレードB          │
│                                         │
│ PRリードタイムが長く、開発速度が低下して  │
│ います。レビュー体制の改善を推奨します。  │
├─────────────────────────────────────────┤
│ ▶ PRリードタイム: 8.2日  🟡              │
│ ▶ コミット頻度: 2.80/日  🟢              │
│ ▶ レビュー待ち: 12.5h   🟢              │
│ ▶ オープン数: PR 5 / Issue 12           │
└─────────────────────────────────────────┘
```

カテゴリの一行診断は、そのカテゴリ内で最も深刻な問題を要約したテキスト。
問題がなければ「良好な状態です」と表示。

---

## メトリクス体系

Lokup は4つのカテゴリでリポジトリの健全性を評価する。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Lokup メトリクス                               │
├─────────────────┬─────────────────┬─────────────────┬───────────────────┤
│    開発速度      │    コード品質    │    技術的負債    │   チーム健全性    │
│   (Velocity)    │    (Quality)    │   (Tech Debt)   │    (Health)      │
├─────────────────┼─────────────────┼─────────────────┼───────────────────┤
│ PRリードタイム   │ バグ修正割合     │ 巨大ファイル     │ 深夜労働率        │
│ コミット頻度     │ 変更集中        │ 古い依存         │ 属人化           │
│ レビュー待ち     │ PRサイズ        │ 機能投資比率     │ リポジトリ規模    │
│ オープン数       │ Issueクローズ率  │                 │                  │
│ デプロイ頻度 ★  │ 変更失敗率 ★    │                 │                  │
│ MTTR ★         │ コードチャーン   │                 │                  │
└─────────────────┴─────────────────┴─────────────────┴───────────────────┘
★ = DORA Four Keys メトリクス
```

### トレンド比較

各メトリクスについて、今期と前期（同じ日数の直前期間）を比較し、変化率を表示する。

| 指標 | 方向 | 意味 |
|------|------|------|
| ↑ +12% | 上昇 | 前期比で増加（変化率 > +5%） |
| ↓ -8% | 下降 | 前期比で減少（変化率 < -5%） |
| → 0% | 横ばい | 変化なし（±5%以内） |

**比較対象メトリクス:**
- コミット数
- コミット頻度（1日あたり）
- Issueクローズ率

### カテゴリの定義

| カテゴリ | 問い | 主な対象者 |
|---------|-----|-----------|
| **開発速度** | どれだけ速く価値を届けられるか？ | マネージャー、PO |
| **コード品質** | 手戻りなく正しく作れているか？ | エンジニア、マネージャー |
| **技術的負債** | 将来の開発を妨げる要因はないか？ | エンジニア |
| **チーム健全性** | 持続可能な働き方ができているか？ | マネージャー、HR |

---

## 出力形式

### 基本仕様

- ファイル名: `lokup-report.html`
- 単一HTMLファイル（外部CSS/JS依存はCDNのみ）
- ブラウザで開いて閲覧

### 使用ライブラリ

| ライブラリ | 用途 | CDN |
|-----------|------|-----|
| Chart.js | グラフ描画 | cdn.jsdelivr.net/npm/chart.js |

### UIパターン

| パターン | 用途 | 実装方法 |
|---------|------|---------|
| 展開式カード | メトリクスの詳細表示 | HTML `<details>/<summary>` |
| チャート遅延初期化 | 展開時にチャートを描画 | `toggle` イベント + `IntersectionObserver` |
| インライン展開 | 詳細をその場に表示 | `<details>` 内にチャート・テーブル配置 |

**`<details>/<summary>` を採用する理由:**
- JavaScript不要でアコーディオン動作
- アクセシビリティ対応（キーボード、スクリーンリーダー）
- モーダルと異なり、読み手のコンテキスト（読んでいた場所）を維持
- SonarQube、Lighthouse と同じ段階的開示パターン

**チャート遅延初期化:**
```javascript
// 展開されたときだけチャートを生成（パフォーマンス最適化）
document.querySelectorAll('details.metric-detail').forEach(el => {
  el.addEventListener('toggle', () => {
    if (el.open && !el.dataset.initialized) {
      createChart(el.querySelector('canvas'));
      el.dataset.initialized = 'true';
    }
  });
});
```

---

## 開発速度 (Velocity)

チームがどれだけ速く価値を届けられるかを測定する。

### PRリードタイム

PRが作成されてからマージされるまでの平均日数。

| 状態 | 基準 |
|------|------|
| 良好 | 3日以下 |
| 警告 | 7日以上 |

**計算式:**
```
リードタイム(日) = Σ(マージ日時 - 作成日時) / マージ済みPR数
```

**対象:** マージ済みPRのみ

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | PR別リードタイム棒グラフ（色分け: 緑=3日以下、黄=3-7日、赤=7日超） |
| テーブル | 遅いPR Top5（PR番号、タイトル、作成者、リードタイム日数） |
| 診断テキスト | 平均値と基準の比較、外れ値の存在を指摘 |

**チャート仕様:**
- 種類: 横棒グラフ（Bar chart）
- X軸: リードタイム（日数）
- Y軸: PR番号またはタイトル（短縮）
- 色: 基準に応じた3色（緑/黄/赤）
- 目的: 1件の外れ値が平均を引き上げているのか、全体的に遅いのかを判別

### コミット頻度

期間中の1日あたり平均コミット数。

| 状態 | 基準 |
|------|------|
| 活発 | 2以上 |
| 低調 | 0.5未満 |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | 日別コミット推移（折れ線グラフ、既存の日別チャートを流用） |
| 診断テキスト | 平均値と基準の比較、週末作業の傾向 |

### レビュー待ち時間

PR作成から最初のレビューコメントまでの平均時間。

| 状態 | 基準 |
|------|------|
| 良好 | 24時間以内 |
| 警告 | 48時間以上 |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | PR別レビュー待ち時間棒グラフ（色分け: 緑/黄/赤） |
| テーブル | 待ちが長いPR Top5（PR番号、タイトル、待ち時間） |
| 診断テキスト | 平均値と基準の比較 |

### オープンPR/Issue数

現在オープン状態のPRとIssueの数。滞留タスクの量を示す。

| 状態 | 基準 |
|------|------|
| 良好 | 適度（チーム規模による） |
| 警告 | 急増している場合 |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| 表示 | オープンPR数とオープンIssue数をそれぞれ表示 |
| 診断テキスト | 数量の評価 |

### デプロイ頻度（DORA Four Keys）

期間内のリリース数を月換算した値。DORA Four Keys の1つ。

| DORAレーティング | 基準 |
|-----------------|------|
| Elite | 30回以上/月（ほぼ毎日） |
| High | 4〜29回/月（週次） |
| Medium | 1〜3回/月（月次） |
| Low | 1回未満/月 |

**計算式:**
```
デプロイ頻度(回/月) = 期間内リリース数 / (期間日数 / 30)
```

**データソース:** GitHub Releases API (`/repos/{owner}/{repo}/releases`)

**リスク検出:** 月1回未満の場合、`RiskTypeLowDeployFreq` (Medium) を検出。

### MTTR（DORA Four Keys）

バグ/インシデント/ホットフィックスのIssueが作成されてからクローズされるまでの平均時間。
DORA Four Keys の「Mean Time to Recovery」に対応。

| DORAレーティング | 基準 |
|-----------------|------|
| Elite | 1時間未満 |
| High | 1〜24時間 |
| Medium | 24〜168時間（1週間） |
| Low | 168時間以上 |

**計算式:**
```
MTTR(時間) = Σ(クローズ日時 - 作成日時) / 対象Issue数
```

**対象:** `bug`, `incident`, `hotfix` ラベルが付いたクローズ済みIssue

**リスク検出:** 24時間超の場合、`RiskTypeSlowRecovery` (Medium) を検出。

---

## コード品質 (Quality)

手戻りなく正しくコードを書けているかを測定する。

### バグ修正割合

マージ済みPRのうち、バグ修正PRが占める割合。

| 状態 | 基準 |
|------|------|
| 良好 | 30%以下 |
| 警告 | 50%以上 |

**PR分類ルール（ブランチ名で判定）:**

| 分類 | ブランチ名パターン | 例 |
|------|-------------------|-----|
| Feature | `feature/*`, `feat/*` | `feature/add-login` |
| BugFix | `fix/*`, `bugfix/*`, `hotfix/*` | `fix/null-pointer` |
| Refactor | `refactor/*`, `chore/*`, `debt/*`, `ci/*`, `docs/*` | `refactor/cleanup` |
| Other | 上記以外 | `misc/update-config` |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | ドーナツチャート（Feature / BugFix / Refactor / Other の内訳） |
| 診断テキスト | 割合と基準の比較、件数の内訳 |

**チャート仕様:**
- 種類: ドーナツチャート（Doughnut chart）
- セグメント: Feature（青）、BugFix（赤）、Refactor（黄）、Other（グレー）
- 中央に合計PR数を表示
- 目的: 開発リソースの配分を視覚化

### 変更集中

同じファイルが短期間に何度も変更されている状態。ホットスポットの検出。

| 条件 | 重大度 |
|------|--------|
| 30日間で20回以上変更 | High |
| 30日間で10回以上変更 | Medium |

### PRサイズ

PRあたりの平均変更行数。大きすぎるPRはレビューが困難。

| 状態 | 基準 |
|------|------|
| 良好 | 200行以下 |
| 警告 | 500行以上 |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | PR別変更行数棒グラフ（色分け: 緑=200行以下、黄=200-500行、赤=500行超） |
| テーブル | 大きいPR Top5（PR番号、タイトル、変更行数） |
| 診断テキスト | 平均値と基準の比較 |

### Issueクローズ率

期間中に作成されたIssueと、クローズされたIssueの比率。

| 状態 | 基準 |
|------|------|
| 良好 | 100%以上（消化が追いついている） |
| 警告 | 50%以下（負債が溜まっている） |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| 表示 | 作成数とクローズ数をバー比較で表示 |
| 診断テキスト | 比率と基準の比較、消化状況の評価 |

### 変更失敗率（DORA Four Keys）

デプロイ（リリース）に対する障害の割合。DORA Four Keys の1つ。

| DORAレーティング | 基準 |
|-----------------|------|
| Elite | 0〜15% |
| High | 16〜30% |
| Medium | 31〜45% |
| Low | 46%以上 |

**計算式:**
```
変更失敗率(%) = (障害指標数 / デプロイ数) × 100
```

**障害指標:**
- `bug`, `incident`, `hotfix` ラベルが付いた期間内Issue数
- `Revert ` プレフィックスのコミット数

**デプロイ数:** 期間内のリリース数

**リスク検出:** 30%超の場合、`RiskTypeHighChangeFailure` (High) を検出。

### コードチャーン

Revertコミットの数と割合。コードの手戻りを示す。

**計算式:**
```
Revert率(%) = Revertコミット数 / 総コミット数 × 100
```

**検出ルール:** コミットメッセージが `Revert ` で始まるコミットをカウント。

---

## 技術的負債 (Tech Debt)

将来の開発速度を低下させる要因を検出する。

### 巨大ファイル

ファイルサイズが大きく、保守が困難なファイル。

| 条件 | 重大度 |
|------|--------|
| 100KB以上 | High |
| 50KB以上 | Medium |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| テーブル | ファイル一覧（リスクアイコン、パス、サイズKB） |
| 診断テキスト | 件数と重大度の内訳 |

### 古い依存

リリースから長期間経過した依存パッケージ。セキュリティリスク。

| 条件 | 重大度 |
|------|--------|
| 3年以上前のバージョン | High |
| 2年以上前のバージョン | Medium |

**対応エコシステム:**

| エコシステム | 依存ファイル | パッケージレジストリ |
|-------------|-------------|---------------------|
| npm | `package.json` | registry.npmjs.org |
| Go | `go.mod` | proxy.golang.org |
| Python | `requirements.txt` | pypi.org |
| .NET (NuGet) | `*.csproj` | api.nuget.org |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| テーブル | パッケージ一覧（リスクアイコン、名前、バージョン、経過期間） |
| 診断テキスト | 件数と重大度の内訳 |

### 機能投資比率

マージ済みPRのうち、機能追加（Feature）PRが占める割合。
機能開発への投資が十分かを示す。

| 状態 | 基準 |
|------|------|
| 良好 | 30%以上 |
| 警告 | 30%未満 |

**計算式:**
```
機能投資比率(%) = Feature PR数 / 合計マージ済みPR数 × 100
```

**リスク検出:** 30%未満の場合、`RiskTypeLowFeatureInvestment` (Medium) を検出。

---

## チーム健全性 (Health)

チームが持続可能な働き方をできているかを測定する。

### 深夜労働率

深夜帯（22:00〜翌5:00）に作成されたコミットの割合。

| 状態 | 基準 |
|------|------|
| 良好 | 10%以下 |
| 警告 | 30%以上 |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | 時間帯別コミット分布（24時間棒グラフ、22-5時を赤色ハイライト） |
| 診断テキスト | 割合と基準の比較 |

**チャート仕様:**
- 種類: 棒グラフ（Bar chart）
- X軸: 時間帯（0時〜23時）
- Y軸: コミット数
- 色: 通常時間帯（青）、深夜帯 22-5時（赤）
- 目的: いつ作業しているかの分布を可視化

### 属人化

1人のコントリビューターがコミットの大部分を占める状態。バス係数リスク。

| 条件 | 重大度 |
|------|--------|
| 1人が80%以上のコミット | Medium |

**ドリルダウン詳細:**

| 項目 | 内容 |
|------|------|
| チャート | コントリビューター別コミット数横棒グラフ |
| 診断テキスト | トップコントリビューターの割合と基準の比較 |

**チャート仕様:**
- 種類: 横棒グラフ（Horizontal bar chart）
- X軸: コミット数
- Y軸: コントリビューター名
- 色: 80%超（赤）、その他（青）
- 目的: 知識の偏りを視覚化

---

## スコア計算

各カテゴリは100点満点でスコア化される。

### 総合スコア

4カテゴリスコアの平均値。レポートのヒーローセクションに大きく表示される。

```
総合スコア = (開発速度 + コード品質 + 技術的負債 + チーム健全性) / 4
```

**総合診断テキスト:**
- グレードA: 「全体的に良好な状態です。」
- グレードB: 「概ね良好ですが、{最低カテゴリ}に改善の余地があります。」
- グレードC: 「{最低カテゴリ}を中心に改善が必要です。」
- グレードD: 「{最低カテゴリ}に重大な課題があります。早急な対応を推奨します。」

### 減点ルール

検出されたリスクに応じて減点。

| リスク重大度 | 減点 |
|-------------|------|
| High (🔴) | -15点 |
| Medium (🟡) | -10点 |
| Low (🟢) | -5点 |

### グレード

| スコア | グレード | 評価 |
|--------|---------|------|
| 80-100 | A | 良好 |
| 60-79 | B | 普通 |
| 40-59 | C | 要改善 |
| 0-39 | D | 危険 |

### カテゴリ別スコアと診断テキスト

各カテゴリのスコアは、そのカテゴリに属するリスクのみから計算する。
スコアに応じて、カテゴリヘッダーに一行診断テキストを表示する。

**診断テキストの生成ルール:**
- グレードA: 「良好な状態です」
- グレードB-D: カテゴリ内で最も減点の大きいリスクを要約
  - 例: 「PRリードタイムが長く、開発速度が低下しています」
  - 例: 「巨大ファイルが多数あり、保守性に課題があります」

### スコア内訳（Score Breakdown）

各カテゴリスコアは内訳表を持ち、減点の根拠を確認できる。

```
┌─────────────────────────────────────────┐
│ スコア内訳                               │
├──────────────────┬──────┬───────────────┤
│ 基本スコア        │ +100 │               │
│ PRリードタイム超過 │  -10 │ 平均8.2日     │
│ PRサイズ超過      │  -10 │ 平均620行     │
├──────────────────┼──────┼───────────────┤
│ 合計             │  80  │ グレードA      │
└──────────────────┴──────┴───────────────┘
```

---

## ドリルダウン詳細の共通フォーマット

### 展開時の情報構成

すべてのメトリクスの展開時は以下の順序で情報を表示する:

```
1. 📋 診断テキスト
   現在の値と基準の比較、状況の説明

2. 📊 チャート（該当するメトリクスのみ）
   データの分布やパターンを視覚化

3. 📝 エビデンステーブル（該当するメトリクスのみ）
   問題の原因となっている具体的な項目

4. 🔥 放置した場合のリスク
   対応しない場合に起こる問題

5. 💡 改善提案
   具体的なアクション
```

### メトリクスごとのドリルダウン対応表

| メトリクス | チャート | テーブル | 診断 | リスク/提案 |
|-----------|---------|---------|------|-----------|
| PRリードタイム | PR別棒グラフ | 遅いPR Top5 | ✅ | ✅ |
| コミット頻度 | 日別折れ線 | - | ✅ | ✅ |
| レビュー待ち時間 | PR別棒グラフ | 待ち長いPR Top5 | ✅ | ✅ |
| オープンPR/Issue | - | - | ✅ | ✅ |
| デプロイ頻度 | DORAバッジ | - | ✅ | ✅ |
| MTTR | DORAバッジ | - | ✅ | ✅ |
| バグ修正割合 | ドーナツ（4分類） | - | ✅ | ✅ |
| 変更集中 | - | ホットスポット一覧 | ✅ | ✅ |
| PRサイズ | PR別棒グラフ | 大きいPR Top5 | ✅ | ✅ |
| Issueクローズ率 | 作成/クローズ比較バー | - | ✅ | ✅ |
| 変更失敗率 | DORAバッジ | - | ✅ | ✅ |
| コードチャーン | - | - | ✅ | - |
| 巨大ファイル | - | ファイル一覧 | ✅ | ✅ |
| 古い依存 | - | パッケージ一覧 | ✅ | ✅ |
| 機能投資比率 | ドーナツ（4分類） | - | ✅ | ✅ |
| 深夜労働率 | 時間帯別棒グラフ | - | ✅ | ✅ |
| 属人化 | コントリビュータ別棒グラフ | - | ✅ | ✅ |

---

## 日別コミットチャート

分析期間中の日ごとのコミット数を折れ線グラフで表示。

### 表示形式

- X軸: 日付（`1/25(土)` 形式で曜日付き）
- Y軸: コミット数

### 読み取れること

- 週末の作業傾向（土日にコミットが多い → 過負荷の可能性）
- 締め切り前の駆け込み（特定日に集中 → 計画性の問題）
- 開発の継続性（0の日が続く → 開発停滞）

---

## 結果の解釈ガイド

### よくあるパターンと対策

| パターン | 原因の可能性 | 対策 |
|---------|-------------|------|
| 深夜コミット率が高い | 締め切り圧力、人手不足 | スプリント計画の見直し、人員追加 |
| PRリードタイムが長い | レビュー待ち、PRが大きすぎる | レビュー時間の確保、PRの分割 |
| バグ修正割合が高い | テスト不足、技術的負債 | テストカバレッジ向上、リファクタリング |
| 属人化リスク | 知識の偏り | ペアプロ、コードレビュー、ドキュメント整備 |
| 古い依存が多い | メンテナンス不足 | Dependabot導入、定期更新の習慣化 |
| PRサイズが大きい | 機能の分割不足 | 小さなPRに分割、フィーチャーフラグ活用 |

### カテゴリ間の相関パターン

複数のカテゴリを横断して読むことで、より深い問題が見える。

| 開発速度 | コード品質 | 解釈 |
|---------|-----------|------|
| 高い | 低い | 品質を犠牲にして速度を出している（危険） |
| 低い | 高い | 慎重だが遅い（改善余地あり） |
| 低い | 低い | 全体的に停滞（根本原因の調査が必要） |
| 高い | 高い | 理想的な状態 |

---

## 参考フレームワーク

### DORA Four Keys

| 指標 | Lokup対応 | DORAレーティング |
|-----|----------|----------------|
| Deployment Frequency | デプロイ頻度 ✅ | Elite/High/Medium/Low |
| Lead Time for Changes | PRリードタイム ✅ | - |
| Change Failure Rate | 変更失敗率 ✅ | Elite/High/Medium/Low |
| Mean Time to Recovery | MTTR ✅ | Elite/High/Medium/Low |

### SPACE Framework

| 次元 | Lokup対応 |
|-----|----------|
| Satisfaction | 深夜労働率（間接指標） |
| Performance | バグ修正割合、変更集中 |
| Activity | コミット頻度 |
| Communication | 属人化、レビュー待ち時間 |
| Efficiency | PRリードタイム |

---

## AI分析コメント

レポートHTML内の `<div id="ai-comments">` セクションに、生成AIによる分析コメントを追記できる。

### 追記方法

| 方法 | 手順 |
|------|------|
| Claude Code | `/analyze-report report.html` スキルを実行 |
| 他のAI | `scripts/analyze-report-prompt.md` のプロンプトを使用 |

### コメント構造

```
ヒーローインサイト    ← 最も重要な発見1つ + 具体的アクション
インサイトカード      ← 良い点(good)・注意(warn)・深刻(bad) 各1-3個
優先アクション        ← 今すぐ取り組むべきこと 1-3個
補足（折りたたみ）    ← データの制約や注意事項
```

各要素のCSSクラスは `features/report/template.html` に定義済み。

---

## 制限事項

- ブランチ命名規則に従っていないリポジトリでは、PR分類（Feature/BugFix/Refactor/Other）が正確に機能しない
- GitHub API のレート制限により、大規模リポジトリでは一部データが取得できない場合がある
- コミット日時はGitHub APIから取得したUTC時刻を使用
- 依存検出は各パッケージレジストリへのAPIコールが発生するため、依存が多いリポジトリでは時間がかかる
- Pythonの `pyproject.toml` や `Pipfile` には未対応
- モノレポ構成の場合、ルート以外の依存ファイルは検出されない場合がある（.csprojを除く）
- プライベートリポジトリの分析にはGitHubトークンが必要
- レビュー待ち時間はAPIコール節約のため、直近20件のマージ済みPRから計算
- デプロイ頻度はGitHub Releasesを使用。Releases未使用のリポジトリでは「N/A」表示
- 変更失敗率はIssueラベル（bug/incident/hotfix）に依存。ラベル未使用では正確に計算できない
- MTTRはIssueのクローズ日時を復旧完了とみなす。実際の復旧とずれる場合がある
- コミットの変更ファイル一覧（変更集中リスク検出用）はAPIコール制約により未取得（TODO）
- トレンド比較は前期データ取得のためAPIコールが追加で2件発生する
